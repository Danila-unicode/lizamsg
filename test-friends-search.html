<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ø–æ –¥—Ä—É–∑—å—è–º</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .test-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #1976D2;
        }
        
        .test-results {
            margin-top: 15px;
            padding: 10px;
            background: #e8f5e8;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        
        .test-error {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }
        
        .friends-search-container {
            position: relative;
            margin: 10px 0;
        }
        
        .friends-search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
            background: #f8f9fa;
        }
        
        .friends-search-input:focus {
            border-color: #2196F3;
            background: white;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }
        
        .friends-search-clear {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .friends-search-clear:hover {
            background: #f0f0f0;
            color: #666;
        }
        
        .friends-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            background: #fafafa;
        }
        
        .friend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border: 1px solid #eee;
            margin: 3px 0;
            border-radius: 3px;
            background: white;
            cursor: pointer;
        }
        
        .friend-item:hover {
            background: #f0f8ff;
        }
        
        .friend-item .username {
            font-weight: bold;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 5px;
        }
        
        .btn-primary {
            background: #2196F3;
            color: white;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1><i class="fas fa-search"></i> –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ø–æ –¥—Ä—É–∑—å—è–º</h1>
        
        <div class="test-section">
            <h3>üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
            <button class="test-button" onclick="setupTestData()">
                <i class="fas fa-database"></i> –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            </button>
            <button class="test-button" onclick="loadFriendsData()">
                <i class="fas fa-users"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥—Ä—É–∑–µ–π
            </button>
            <div id="setupResults" class="test-results" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</h3>
            
            <!-- –ü–æ–∏—Å–∫ –ø–æ –¥—Ä—É–∑—å—è–º -->
            <div class="friends-search-container">
                <input type="text" id="friendsSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏–ª–∏ –∏–º–µ–Ω–∏" class="friends-search-input" oninput="filterFriends()" autocomplete="new-password" autocapitalize="off" autocorrect="off" spellcheck="false" readonly onfocus="this.removeAttribute('readonly')">
                <button onclick="clearFriendsSearch()" class="friends-search-clear" title="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="friendsList" class="friends-list">
                <p style="text-align: center; color: #666; padding: 20px;">
                    <i class="fas fa-users"></i> –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –ø—É—Å—Ç
                </p>
            </div>
            
            <button class="test-button" onclick="testSearchScenarios()">
                <i class="fas fa-vial"></i> –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∏—Å–∫–∞
            </button>
        </div>
        
        <div class="test-section">
            <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</h3>
            <div id="testResults"></div>
        </div>
    </div>

    <script src="js/contacts-handler.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        let friendsData = {
            friends: []
        };
        
        // –ê–ª–∏–∞—Å –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ saveContactName
        async function saveContact(phone, name) {
            return await saveContactName(phone, name);
        }
        
        // –ê–ª–∏–∞—Å –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ getContactName (–µ—Å–ª–∏ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞)
        async function getContactName(phone) {
            if (typeof window.getContactName === 'function') {
                return await window.getContactName(phone);
            }
            // –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
            if (!contactsDB) {
                await initContactsDB();
            }
            
            return new Promise((resolve, reject) => {
                const transaction = contactsDB.transaction(['contacts'], 'readonly');
                const store = transaction.objectStore('contacts');
                const request = store.get(phone);
                
                request.onsuccess = () => {
                    if (request.result) {
                        resolve(request.result.name);
                    } else {
                        resolve(null);
                    }
                };
                request.onerror = () => reject(request.error);
            });
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        async function setupTestData() {
            const resultsDiv = document.getElementById('setupResults');
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'test-results';
            
            try {
                console.log('üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º IndexedDB
                await initContactsDB();
                console.log('‚úÖ IndexedDB –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
                await addTestContacts();
                console.log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã');
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥—Ä—É–∑–µ–π
                friendsData = {
                    friends: [
                        {
                            contact_user_id: 1,
                            username: '+79182725362',
                            status: 'active'
                        },
                        {
                            contact_user_id: 2,
                            username: '+79298290753',
                            status: 'active'
                        },
                        {
                            contact_user_id: 3,
                            username: '+79001234567',
                            status: 'active'
                        }
                    ]
                };
                
                resultsDiv.innerHTML = `
                    <h4>‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã</h4>
                    <p><strong>–î—Ä—É–∑—å—è:</strong> ${friendsData.friends.length}</p>
                    <p><strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã –≤ IndexedDB:</strong> 3</p>
                    <ul>
                        <li>+79182725362 ‚Üí –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤</li>
                        <li>+79298290753 ‚Üí –ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞</li>
                        <li>+79001234567 ‚Üí –ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤</li>
                    </ul>
                `;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:', error);
                resultsDiv.className = 'test-results test-error';
                resultsDiv.innerHTML = `<h4>‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h4><p>${error.message}</p>`;
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
        async function addTestContacts() {
            const contacts = [
                { phone: '+79182725362', name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤' },
                { phone: '+79298290753', name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞' },
                { phone: '+79001234567', name: '–ê–ª–µ–∫—Å–µ–π –ö–æ–∑–ª–æ–≤' }
            ];
            
            for (const contact of contacts) {
                await saveContact(contact.phone, contact.name);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π
        async function loadFriendsData() {
            const resultsDiv = document.getElementById('setupResults');
            resultsDiv.style.display = 'block';
            resultsDiv.className = 'test-results';
            
            try {
                console.log('üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π...');
                
                // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥—Ä—É–∑–µ–π
                updateFriendsList();
                
                resultsDiv.innerHTML = `
                    <h4>‚úÖ –î–∞–Ω–Ω—ã–µ –¥—Ä—É–∑–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω—ã</h4>
                    <p><strong>–ù–∞–π–¥–µ–Ω–æ –¥—Ä—É–∑–µ–π:</strong> ${friendsData.friends.length}</p>
                `;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                resultsDiv.className = 'test-results test-error';
                resultsDiv.innerHTML = `<h4>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h4><p>${error.message}</p>`;
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π
        async function updateFriendsList() {
            const friendsList = document.getElementById('friendsList');
            
            if (!friendsData.friends || friendsData.friends.length === 0) {
                friendsList.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;"><i class="fas fa-users"></i> –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –ø—É—Å—Ç</p>';
                return;
            }
            
            let friendsHtml = '';
            
            for (const friend of friendsData.friends) {
                try {
                    const contactName = await getContactName(friend.username);
                    const displayName = contactName || friend.username;
                    
                    friendsHtml += `
                        <div class="friend-item" onclick="selectFriend('${friend.username}')">
                            <div class="username">
                                <span class="friend-display-name" data-phone="${friend.username}">${displayName}</span>
                                <br>
                                <small style="color: #999; font-size: 11px;">${friend.username}</small>
                            </div>
                            <div class="actions">
                                <button class="btn-primary btn-small" title="–ü–æ–∑–≤–æ–Ω–∏—Ç—å">
                                    <i class="fas fa-phone"></i>
                                </button>
                                <button class="btn-info btn-small" title="–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫">
                                    <i class="fas fa-video"></i>
                                </button>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    console.error(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥—Ä—É–≥–∞ ${friend.username}:`, error);
                }
            }
            
            friendsList.innerHTML = friendsHtml;
        }
        
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—Ä—É–∑–µ–π –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
        async function filterFriends() {
            const searchInput = document.getElementById('friendsSearchInput');
            let searchQuery = searchInput.value.toLowerCase().trim();
            
            // –£–±–∏—Ä–∞–µ–º —Å–∏–º–≤–æ–ª + –∏–∑ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
            searchQuery = searchQuery.replace(/\+/g, '');
            
            const friendsList = document.getElementById('friendsList');
            
            if (!searchQuery) {
                updateFriendsList();
                return;
            }
            
            console.log(`üîç –ü–æ–∏—Å–∫ –ø–æ –¥—Ä—É–∑—å—è–º: "${searchQuery}" (—Å–∏–º–≤–æ–ª + –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)`);
            
            try {
                const allFriends = friendsData.friends || [];
                const filteredFriends = [];
                
                for (const friend of allFriends) {
                    let matches = false;
                    const phoneNumber = friend.username;
                    
                    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    console.log(`üìû –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–º–µ—Ä: ${phoneNumber}, –ø–æ–∏—Å–∫: "${searchQuery}"`);
                    
                    // –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞)
                    if (friend.username) {
                        // –£–±–∏—Ä–∞–µ–º + –∏–∑ –Ω–æ–º–µ—Ä–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                        const phoneWithoutPlus = phoneNumber.replace(/\+/g, '');
                        
                        // –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –±–µ–∑ +
                        if (phoneWithoutPlus.includes(searchQuery)) {
                            matches = true;
                            console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: ${phoneWithoutPlus} —Å–æ–¥–µ—Ä–∂–∏—Ç ${searchQuery}`);
                        }
                        
                        // –ü–æ–∏—Å–∫ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º —Ü–∏—Ñ—Ä–∞–º (–±–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã)
                        if (!matches) {
                            const lastDigits = phoneWithoutPlus.replace(/^7/, ''); // –£–±–∏—Ä–∞–µ–º 7
                            if (lastDigits.includes(searchQuery)) {
                                matches = true;
                                console.log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –±–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã: ${lastDigits} —Å–æ–¥–µ—Ä–∂–∏—Ç ${searchQuery}`);
                            }
                        }
                        
                        if (!matches) {
                            console.log(`‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –¥–ª—è ${phoneNumber}`);
                        }
                    }
                    
                    // –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–∑ –∑–∞–ø–∏—Å–Ω–æ–π –∫–Ω–∏–∂–∫–∏
                    if (!matches && friend.username) {
                        try {
                            const contactName = await getContactName(friend.username);
                            if (contactName && contactName.toLowerCase().includes(searchQuery)) {
                                matches = true;
                            }
                        } catch (error) {
                            console.warn(`‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –¥–ª—è ${friend.username}:`, error);
                        }
                    }
                    
                    if (matches) {
                        filteredFriends.push(friend);
                    }
                }
                
                displayFilteredFriends(filteredFriends, searchQuery);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥—Ä—É–∑–µ–π:', error);
                friendsList.innerHTML = '<p style="color: red; text-align: center;">–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞</p>';
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π
        async function displayFilteredFriends(friends, searchQuery) {
            const friendsList = document.getElementById('friendsList');
            
            if (friends.length === 0) {
                friendsList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #666;">
                        <i class="fas fa-search" style="font-size: 24px; margin-bottom: 10px; opacity: 0.5;"></i>
                        <p>–ü–æ –∑–∞–ø—Ä–æ—Å—É "<strong>${searchQuery}</strong>" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                        <p style="font-size: 12px; margin-top: 10px;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
                    </div>
                `;
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ —Å—Ç–∏–ª—å, —á—Ç–æ –∏ –æ–±—ã—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
            const friendsHtml = friends.map(friend => {
                return `
                    <div class="friend-item" data-friend="${friend.username}" onclick="selectFriend('${friend.username}')" style="cursor: pointer; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f0f0f0'" onmouseout="this.style.backgroundColor='white'">
                        <div class="username" style="position: relative;">
                            <div class="friend-avatar" style="display: inline-block; width: 20px; height: 20px; border-radius: 50%; background: #ddd; margin-right: 8px; vertical-align: middle; text-align: center; line-height: 20px; font-size: 12px; color: #666;" data-user-id="${friend.contact_user_id}">
                                <i class="fas fa-user" style="font-size: 10px;"></i>
                            </div>
                            <span class="friend-display-name" data-phone="${friend.username}">${friend.username}</span>
                        </div>
                        <div class="actions" onclick="event.stopPropagation()">
                            <div class="call-buttons">
                                <button onclick="selectFriend('${friend.username}')" class="btn-primary btn-small" title="–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫"><i class="fas fa-video"></i> –í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫</button>
                                <button onclick="selectFriend('${friend.username}')" class="btn-secondary btn-small" title="–ê—É–¥–∏–æ–∑–≤–æ–Ω–æ–∫"><i class="fas fa-microphone"></i> –ê—É–¥–∏–æ–∑–≤–æ–Ω–æ–∫</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            friendsList.innerHTML = friendsHtml;
        }
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
        function highlightSearchText(text, searchQuery) {
            if (!searchQuery) return text;
            
            const regex = new RegExp(`(${searchQuery})`, 'gi');
            return text.replace(regex, '<mark style="background: #ffeb3b; padding: 1px 2px; border-radius: 2px;">$1</mark>');
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
        function clearFriendsSearch() {
            const searchInput = document.getElementById('friendsSearchInput');
            searchInput.value = '';
            updateFriendsList();
            searchInput.focus();
        }
        
        // –í—ã–±–æ—Ä –¥—Ä—É–≥–∞
        function selectFriend(username) {
            console.log(`üë§ –í—ã–±—Ä–∞–Ω –¥—Ä—É–≥: ${username}`);
            alert(`–í—ã–±—Ä–∞–Ω –¥—Ä—É–≥: ${username}`);
        }
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∏—Å–∫–∞
        async function testSearchScenarios() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<h4>üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤...</h4>';
            
            const scenarios = [
                { query: '–∏–≤–∞–Ω', expected: 1, description: '–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ "–∏–≤–∞–Ω"' },
                { query: '–º–∞—Ä–∏—è', expected: 1, description: '–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ "–º–∞—Ä–∏—è"' },
                { query: '+79182725362', expected: 1, description: '–ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª–Ω–æ–º—É –Ω–æ–º–µ—Ä—É —Å + (—Å–∏–º–≤–æ–ª + –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)' },
                { query: '79182725362', expected: 1, description: '–ü–æ–∏—Å–∫ –ø–æ –ø–æ–ª–Ω–æ–º—É –Ω–æ–º–µ—Ä—É –±–µ–∑ +' },
                { query: '7918', expected: 1, description: '–ü–æ–∏—Å–∫ –ø–æ —á–∞—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞ "7918"' },
                { query: '7929', expected: 1, description: '–ü–æ–∏—Å–∫ –ø–æ —á–∞—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞ "7929"' },
                { query: '9182725362', expected: 1, description: '–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –±–µ–∑ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã' },
                { query: '+7918', expected: 1, description: '–ü–æ–∏—Å–∫ –ø–æ —á–∞—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞ —Å + (—Å–∏–º–≤–æ–ª + –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)' },
                { query: '+7929', expected: 1, description: '–ü–æ–∏—Å–∫ –ø–æ —á–∞—Å—Ç–∏ –Ω–æ–º–µ—Ä–∞ —Å + (—Å–∏–º–≤–æ–ª + –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)' },
                { query: '–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π', expected: 0, description: '–ü–æ–∏—Å–∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞' },
                { query: '', expected: 3, description: '–ü—É—Å—Ç–æ–π –ø–æ–∏—Å–∫ (–≤—Å–µ –¥—Ä—É–∑—å—è)' }
            ];
            
            let passedTests = 0;
            let totalTests = scenarios.length;
            
            for (const scenario of scenarios) {
                try {
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
                    const searchInput = document.getElementById('friendsSearchInput');
                    searchInput.value = scenario.query;
                    
                    // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫
                    await filterFriends();
                    
                    // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    const friendsList = document.getElementById('friendsList');
                    const friendItems = friendsList.querySelectorAll('.friend-item');
                    const actualResults = friendItems.length;
                    
                    const passed = actualResults === scenario.expected;
                    if (passed) passedTests++;
                    
                    const status = passed ? '‚úÖ' : '‚ùå';
                    const result = `
                        <div style="margin: 5px 0; padding: 5px; background: ${passed ? '#e8f5e8' : '#ffebee'}; border-radius: 3px;">
                            ${status} <strong>${scenario.description}</strong><br>
                            <small>–û–∂–∏–¥–∞–ª–æ—Å—å: ${scenario.expected}, –ü–æ–ª—É—á–µ–Ω–æ: ${actualResults}</small>
                        </div>
                    `;
                    
                    resultsDiv.innerHTML += result;
                    
                } catch (error) {
                    console.error(`‚ùå –û—à–∏–±–∫–∞ –≤ —Å—Ü–µ–Ω–∞—Ä–∏–∏ "${scenario.description}":`, error);
                    resultsDiv.innerHTML += `
                        <div style="margin: 5px 0; padding: 5px; background: #ffebee; border-radius: 3px;">
                            ‚ùå <strong>${scenario.description}</strong><br>
                            <small>–û—à–∏–±–∫–∞: ${error.message}</small>
                        </div>
                    `;
                }
            }
            
            // –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            const successRate = Math.round((passedTests / totalTests) * 100);
            resultsDiv.innerHTML += `
                <div style="margin-top: 15px; padding: 10px; background: ${successRate === 100 ? '#e8f5e8' : '#fff3e0'}; border-radius: 5px; border-left: 4px solid ${successRate === 100 ? '#4CAF50' : '#FF9800'};">
                    <h4>üìä –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h4>
                    <p><strong>–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤:</strong> ${passedTests}/${totalTests} (${successRate}%)</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${successRate === 100 ? '–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!' : '–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã'}</p>
                </div>
            `;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ø–æ –¥—Ä—É–∑—å—è–º –∑–∞–≥—Ä—É–∂–µ–Ω');
        });
    </script>
</body>
</html>

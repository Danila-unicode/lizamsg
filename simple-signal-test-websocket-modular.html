<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏ - LizaApp</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background: #f8f9fa; height: 100vh; overflow: hidden; }
        .app-header { background: #2c3e50; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .logo { color: white; font-size: 24px; font-weight: 600; }
        .user-info { display: flex; align-items: center; gap: 15px; color: white; }
        .user-avatar { width: 40px; height: 40px; background: #3498db; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; color: white; }
        .logout-btn { background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: 500; }
        .logout-btn:hover { background: #c0392b; }
        .container { height: calc(100vh - 70px); padding: 0; border-radius: 0; box-shadow: none; margin: 0; display: flex; flex-direction: row; }
        .sidebar { width: 33.33%; background: white; border-right: 1px solid #ecf0f1; display: flex; flex-direction: column; }
        .main-content { width: 66.67%; background: #f8f9fa; display: flex; flex-direction: column; position: relative; }
        .tabs { display: flex; border-bottom: 1px solid #ecf0f1; background: white; }
        .tab { padding: 15px 20px; cursor: pointer; border-bottom: 3px solid transparent; background: white; color: #7f8c8d; font-weight: 500; transition: all 0.2s; }
        .tab.active { background: white; border-bottom-color: #3498db; color: #2c3e50; }
        .tab:hover { background: #f8f9fa; }
        .tab-content { flex: 1; padding: 20px; overflow-y: auto; background: white; }
        .user-section { border: none; padding: 20px; margin: 10px 0; border-radius: 0; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .log { background: #f8f9fa; padding: 15px; height: 200px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 13px; border-radius: 4px; border: 1px solid #ecf0f1; }
        button { padding: 12px 24px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; font-weight: 500; font-size: 14px; transition: all 0.2s; }
        input { padding: 12px 16px; margin: 5px; border: 1px solid #bdc3c7; border-radius: 4px; font-size: 14px; transition: border-color 0.2s; }
        input:focus { outline: none; border-color: #3498db; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        .info { color: blue; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; font-weight: bold; }
        .status.connected { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.disconnected { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.connecting { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π */
        .message-item { cursor: pointer; transition: all 0.2s ease; }
        .message-item:hover { background-color: #f8f9fa; }
        .message-item.selected { background-color: #e3f2fd; border-left: 4px solid #2196f3; }
        .message-item.selected::before { content: "‚úì"; color: #2196f3; font-weight: bold; margin-right: 8px; }
        
        /* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è */
        .delete-button { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: #f44336; 
            color: white; 
            border: none; 
            border-radius: 50%; 
            width: 60px; 
            height: 60px; 
            font-size: 24px; 
            cursor: pointer; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
        }
        .delete-button:hover { background: #d32f2f; }
        .delete-button:active { transform: scale(0.95); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –¥—Ä—É–∑–µ–π */
        .friends-section { margin: 20px 0; }
        .search-section { margin: 15px 0; }
        .search-results { margin: 10px 0; }
        .user-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border: 1px solid #ddd; margin: 5px 0; border-radius: 5px; background: #f9f9f9; }
        .user-item .username { font-weight: bold; }
        .user-item .actions { display: flex; gap: 5px; }
        .friends-list, .requests-list, .sent-requests-list { max-height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px; padding: 10px; margin: 10px 0; background: #fafafa; }
        .friend-item, .request-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border: 1px solid #eee; margin: 3px 0; border-radius: 3px; background: white; }
        .friend-item .username, .request-item .username { font-weight: bold; }
        .friend-item .actions, .request-item .actions { display: flex; gap: 5px; }
        .btn-small { padding: 5px 10px; font-size: 12px; }
        .btn-success { background: #27ae60; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-primary { background: #3498db; color: white; }
        .btn-secondary { background: #95a5a6; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-small { padding: 8px 16px; font-size: 12px; border-radius: 3px; }
        
        /* –°–∫—Ä—ã—Ç–∏–µ —Å—Ç–∞—Ä—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        .old-functionality { display: none !important; }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div class="app-header">
        <div class="logo">
            üìû LizaApp
        </div>
        <div class="user-info" id="headerUserInfo" style="display: none;">
            <div class="user-avatar" id="userAvatar">U</div>
            <span id="currentUserId"></span>
            <button class="logout-btn" onclick="resetUser()">–í—ã–π—Ç–∏</button>
            <button onclick="toggleFileStorage()" id="fileStorageBtn" style="background: #2196F3; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-left: 10px; font-size: 12px;">üìÅ –§–∞–π–ª—ã</button>
        </div>
    </div>

    <div class="container">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('friends')">–î—Ä—É–∑—å—è</div>
                <div class="tab" onclick="switchTab('requests')">–ó–∞–ø—Ä–æ—Å—ã</div>
                <div class="tab" onclick="switchTab('invitations')">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</div>
            </div>
            <div class="tab-content">
                <!-- –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                <div class="search-section">
                    <h3>üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                    <input type="text" id="searchUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" style="width: 300px;">
                    <button onclick="searchUser()" class="btn-primary">üîç –ù–∞–π—Ç–∏</button>
                    <div id="searchResults"></div>
                </div>
                
                <!-- –¢–∞–± –î—Ä—É–∑—å—è -->
                <div id="friendsTab" class="tab-panel">
                    <h3>–ú–æ–∏ –¥—Ä—É–∑—å—è</h3>
                    <div id="friendsList" class="friends-list"></div>
                </div>
                
                <!-- –¢–∞–± –ó–∞–ø—Ä–æ—Å—ã -->
                <div id="requestsTab" class="tab-panel" style="display: none;">
                    <h3>–í—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã</h3>
                    <div id="requestsList" class="requests-list"></div>
                </div>
                
                <!-- –¢–∞–± –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è -->
                <div id="invitationsTab" class="tab-panel" style="display: none;">
                    <h3>–ò—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã</h3>
                    <div id="sentRequestsList" class="sent-requests-list"></div>
                </div>
            </div>
        </div>
            
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <h1>üìû –í–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∏ LizaApp</h1>
            <p><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ —Å–≤–æ–∏–º –ª–æ–≥–∏–Ω–æ–º –∏ –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é. –í—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å —ç—Ç—É –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.</p>
            <button onclick="window.open('https://lizaapp.wg01.ru/register.php', '_blank')" style="background: #4CAF50; color: white; padding: 10px 20px; margin: 10px 0; border: none; border-radius: 5px; cursor: pointer;">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
        
        <div class="user-section profile-section">
            <h2>üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
            <div id="loginSection">
                <input type="text" id="userId" value="" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ª–æ–≥–∏–Ω">
                <input type="password" id="userPassword" value="" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="display: none;">
                <button onclick="showPasswordField(event)">–í–æ–π—Ç–∏</button>
                </div>
            
            <div id="userInfo" style="display: none;">
                <div id="userStatus" class="status disconnected">–û—Ç–∫–ª—é—á–µ–Ω</div>
                <p><strong>–õ–æ–≥–∏–Ω:</strong> <span id="profileCurrentUserId"></span></p>
                <input type="text" id="targetUserId" value="" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞" class="old-functionality">
                <button onclick="startCall()" id="startCallBtn" disabled style="background: #4CAF50; color: white; display: none;" class="old-functionality">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
                <button onclick="disconnectCall()" id="disconnectBtn" disabled style="background: #f44336; color: white; display: none;" class="old-functionality">üîå –†–∞–∑–æ—Ä–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</button>
                <button onclick="resetUser()" style="background: #ff9800; color: white; display: none;">üîÑ –í—ã–π—Ç–∏</button>
                </div>
        
            <!-- –û–∫–Ω–æ –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∞ –≤ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ -->
            <div id="videoCallContainer" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000;">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <div style="background: #2c3e50; color: white; padding: 20px; border-radius: 0;">
                    <h3 style="margin: 0; font-size: 24px; font-weight: 600;">üìπ –í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫</h3>
                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 14px;">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</p>
                </div>
                
                <!-- –û–±–ª–∞—Å—Ç—å –≤–∏–¥–µ–æ -->
                <div style="flex: 1; padding: 30px; display: flex; flex-direction: column; gap: 30px; justify-content: center; align-items: center; background: #f8f9fa; height: calc(100% - 140px);">
                    <!-- –í–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
                    <div style="display: flex; gap: 30px; justify-content: center; align-items: center;">
                        <!-- –õ–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ -->
                        <div style="position: relative;">
                            <video id="localVideo" autoplay muted style="width: 400px; height: 400px; background: #000; border-radius: 10px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.3);"></video>
                            <div style="position: absolute; bottom: 15px; left: 15px; background: #2c3e50; color: white; padding: 8px 15px; border-radius: 4px; font-size: 14px; font-weight: 500;">–í—ã</div>
                        </div>
                        
                        <!-- –£–¥–∞–ª–µ–Ω–Ω–æ–µ –≤–∏–¥–µ–æ -->
                        <div style="position: relative;">
                            <video id="remoteVideo" autoplay style="width: 400px; height: 400px; background: #000; border-radius: 10px; object-fit: cover; box-shadow: 0 4px 12px rgba(0,0,0,0.3);"></video>
                            <div style="position: absolute; bottom: 15px; left: 15px; background: #2c3e50; color: white; padding: 8px 15px; border-radius: 4px; font-size: 14px; font-weight: 500;">–°–æ–±–µ—Å–µ–¥–Ω–∏–∫</div>
                        </div>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞ -->
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="endCall()" style="background: #e74c3c; color: white; border: none; padding: 15px 40px; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.2s;">üìû –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫</button>
                    </div>
                </div>
            </div>
            
            <!-- –û–∫–Ω–æ –∞—É–¥–∏–æ–∑–≤–æ–Ω–∫–∞ –≤ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ -->
            <div id="audioCallContainer" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000;">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <div style="background: #2c3e50; color: white; padding: 20px; border-radius: 0;">
                    <h3 style="margin: 0; font-size: 24px; font-weight: 600;">üéµ –ê—É–¥–∏–æ–∑–≤–æ–Ω–æ–∫</h3>
                    <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 14px;">–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</p>
                </div>
                
                <!-- –û–±–ª–∞—Å—Ç—å –∞—É–¥–∏–æ -->
                <div style="flex: 1; padding: 30px; display: flex; flex-direction: column; gap: 30px; justify-content: center; align-items: center; background: #f8f9fa; height: calc(100% - 140px);">
                    <!-- –ê—É–¥–∏–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
                    <div style="display: flex; gap: 30px; justify-content: center; align-items: center;">
                        <!-- –õ–æ–∫–∞–ª—å–Ω—ã–π –∞—É–¥–∏–æ -->
                        <div style="position: relative;">
                            <div style="width: 200px; height: 200px; background: #3498db; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">üé§</div>
                            <div style="position: absolute; bottom: 15px; left: 15px; background: #2c3e50; color: white; padding: 8px 15px; border-radius: 4px; font-size: 14px; font-weight: 500;">–í—ã</div>
                        </div>
                        
                        <!-- –£–¥–∞–ª–µ–Ω–Ω—ã–π –∞—É–¥–∏–æ -->
                        <div style="position: relative;">
                            <div style="width: 200px; height: 200px; background: #e74c3c; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">üéß</div>
                            <div style="position: absolute; bottom: 15px; left: 15px; background: #2c3e50; color: white; padding: 8px 15px; border-radius: 4px; font-size: 14px; font-weight: 500;">–°–æ–±–µ—Å–µ–¥–Ω–∏–∫</div>
                        </div>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞ -->
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="endCall()" style="background: #e74c3c; color: white; border: none; padding: 15px 40px; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.2s;">üìû –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫</button>
                    </div>
                </div>
            </div>
            
            <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —á–∞—Ç –≤ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ -->
            <div id="chatContainer" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000;">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ -->
                <div style="background: #2c3e50; color: white; padding: 20px; border-radius: 0; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="margin: 0; font-size: 24px; font-weight: 600;">üí¨ –ß–∞—Ç —Å <span id="chatFriendName"></span></h3>
                        <div id="chatStatus" class="status disconnected" style="margin: 5px 0 0 0; padding: 5px 10px; font-size: 12px;">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</div>
                    </div>
                    <button onclick="closeChat()" style="background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px;">‚ùå –ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
                
                <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π -->
                <div style="flex: 1; padding: 20px; display: flex; flex-direction: column; background: #f8f9fa; height: calc(100% - 140px);">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞ -->
                    <div id="chatMessages" style="flex: 1; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px; padding: 15px; background: white; margin-bottom: 15px;"></div>
                    
                    <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="chatMessageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex: 1; padding: 12px 16px; border: 1px solid #bdc3c7; border-radius: 4px; font-size: 14px;">
                        <button onclick="sendChatMessage()" style="background: #3498db; color: white; border: none; padding: 12px 20px; border-radius: 4px; cursor: pointer; font-size: 14px;">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button onclick="callFriendFromChat()" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px;">üìπ –í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫</button>
                        <button onclick="callFriendAudioFromChat()" style="background: #17a2b8; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px;">üéµ –ê—É–¥–∏–æ–∑–≤–æ–Ω–æ–∫</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
        <div class="user-section">
            <h2>üìã –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h2>
            <div id="log" class="log"></div>
            <button onclick="clearLog()" style="background: #ff9800; color: white;">üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
    </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π -->
    <button id="deleteSelectedMessages" class="delete-button" onclick="deleteSelectedMessages()">üóëÔ∏è</button>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥—É–ª—å–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
    <script src="js/messaging-system.js"></script>
    <script src="js/p2p-system.js"></script>
    <script src="js/p2p-functions.js"></script>
    <script src="js/message-deletion-system.js"></script>
    <script src="js/calls-from-chat.js"></script>
    <script src="js/connection-monitoring.js"></script>
    <script src="js/ping-pong-monitoring.js"></script>
    <script src="js/queue-system.js"></script>
    <script src="js/timeout-system.js"></script>
    <script src="js/indexeddb-storage.js"></script>
    <script src="js/localstorage-optimization.js"></script>
    <script src="js/p2p-management.js"></script>
    <script src="js/ui-indicators.js"></script>
    <script src="js/friends-system.js"></script>
    <script src="js/main-app.js"></script>
</body>
</html>
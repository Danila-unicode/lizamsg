<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC –ö–æ–Ω—Ç–∞–∫—Ç—ã - –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .user-info h3 {
            color: #495057;
            margin-bottom: 10px;
        }

        .user-info p {
            color: #6c757d;
            margin: 5px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            min-width: 120px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
        }

        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.connecting {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .video-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .video-box {
            text-align: center;
        }

        .video-box h4 {
            margin-bottom: 10px;
            color: #495057;
        }

        .video-box video {
            width: 100%;
            max-width: 300px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: #000;
        }

        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .log .error {
            color: #ff6b6b;
        }

        .log .success {
            color: #51cf66;
        }

        .log .warning {
            color: #ffd43b;
        }

        .log .info {
            color: #74c0fc;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: #007bff;
            border-bottom-color: #007bff;
        }

        .tab:hover {
            color: #007bff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .contact-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin: 10px 0;
            background: #f8f9fa;
        }

        .contact-info {
            flex: 1;
        }

        .contact-info h4 {
            color: #495057;
            margin-bottom: 5px;
        }

        .contact-info p {
            color: #6c757d;
            font-size: 14px;
        }

        .contact-actions {
            display: flex;
            gap: 10px;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }

        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
        }

        .input-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .quick-actions .btn {
            min-width: 100px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .video-container {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìû WebRTC –ö–æ–Ω—Ç–∞–∫—Ç—ã</h1>
            <p>–£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º WebRTC</p>
        </div>

        <div class="main-content">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
            <div class="card">
                <h2>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
                <div class="user-info">
                    <h3>üë§ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
                    <p><strong>ID:</strong> <span id="currentUserId">–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</span></p>
                    <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <span id="currentUserPhone">-</span></p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="connectionStatus" class="status disconnected">–û—Ç–∫–ª—é—á–µ–Ω</span></p>
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <div class="quick-actions">
                    <button class="btn btn-primary" onclick="quickLogin()">üîë –ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥</button>
                    <button class="btn btn-success" onclick="initWebRTC()">üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å WebRTC</button>
                    <button class="btn btn-warning" onclick="testSignaling()">üì° –¢–µ—Å—Ç —Å–∏–≥–Ω–∞–ª–∏–Ω–≥–∞</button>
                    <button class="btn btn-danger" onclick="stopWebRTC()">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                </div>

                <!-- –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É -->
                <div class="input-group">
                    <label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
                    <input type="text" id="testUserId" value="1" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                </div>

                <button class="btn btn-primary" onclick="loginAsUser()">–í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>

                <!-- –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                <div class="input-group">
                    <label>–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É:</label>
                    <input type="text" id="searchPhone" placeholder="+7XXXXXXXXXX">
                </div>
                <button class="btn btn-primary" onclick="searchUser()">üîç –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                <div id="searchResult"></div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –í–∏–¥–µ–æ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã -->
            <div class="card">
                <h2>üìπ –í–∏–¥–µ–æ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</h2>
                
                <!-- –í–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
                <div class="video-container">
                    <div class="video-box">
                        <h4>üìπ –õ–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ</h4>
                        <video id="localVideo" autoplay muted playsinline></video>
                    </div>
                    <div class="video-box">
                        <h4>üìπ –£–¥–∞–ª–µ–Ω–Ω–æ–µ –≤–∏–¥–µ–æ</h4>
                        <video id="remoteVideo" autoplay playsinline></video>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∏ -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('contacts')">üë• –ö–æ–Ω—Ç–∞–∫—Ç—ã</button>
                    <button class="tab" onclick="switchTab('requests')">üì® –ó–∞–ø—Ä–æ—Å—ã</button>
                    <button class="tab" onclick="switchTab('rejected')">‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ</button>
                </div>

                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
                <div id="contacts-tab" class="tab-content active">
                    <h3>–ú–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <div id="contactsList">
                        <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã...</p>
                    </div>
                </div>

                <div id="requests-tab" class="tab-content">
                    <h3>–í—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã</h3>
                    <div id="requestsList">
                        <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã...</p>
                    </div>
                </div>

                <div id="rejected-tab" class="tab-content">
                    <h3>–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã</h3>
                    <div id="rejectedList">
                        <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
        <div class="card">
            <h2>üìù –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h2>
            <button class="btn btn-warning" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
            <div id="log" class="log"></div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let localStream = null;
        let remoteStream = null;
        let peerConnection = null;
        let currentUser = null;
        let currentCallTarget = null;
        let incomingCallFrom = null;
        let lastSignalId = 0;
        let signalCheckInterval = null;
        let currentUserId = null;
        let isWebRTCInitialized = false;

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WebRTC
        const configuration = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { 
                    urls: 'turn:62.84.126.200:3478', 
                    username: 'webrtc', 
                    credential: 'password123' 
                },
                { 
                    urls: 'turns:62.84.126.200:3479', 
                    username: 'webrtc', 
                    credential: 'password123' 
                }
            ],
            iceCandidatePoolSize: 10,
            sdpSemantics: 'unified-plan'
        };

        // HTTP —Å–∏–≥–Ω–∞–ª–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä
        const SIGNALING_SERVER = 'https://lizamsg.ru:3000/api/signaling';

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : 'üìù';
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.textContent = `[${timestamp}] ${prefix} ${message}`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function updateStatus(status) {
            const statusElement = document.getElementById('connectionStatus');
            statusElement.className = `status ${status}`;
            statusElement.textContent = status === 'connected' ? '–ü–æ–¥–∫–ª—é—á–µ–Ω' : 
                                       status === 'connecting' ? '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...' : '–û—Ç–∫–ª—é—á–µ–Ω';
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('currentUserId').textContent = currentUser.id;
                document.getElementById('currentUserPhone').textContent = currentUser.phone || '-';
            } else {
                document.getElementById('currentUserId').textContent = '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                document.getElementById('currentUserPhone').textContent = '-';
            }
        }

        // –ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function quickLogin() {
            currentUser = {
                id: 1,
                phone: '+79182725362',
                name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 1'
            };
            currentUserId = `user${currentUser.id}`;
            updateUserInfo();
            log('–ë—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
        }

        // –í—Ö–æ–¥ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        function loginAsUser() {
            const userId = document.getElementById('testUserId').value;
            if (!userId) {
                log('–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error');
                return;
            }

            currentUser = {
                id: parseInt(userId),
                phone: `+7918272536${userId}`,
                name: `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId}`
            };
            currentUserId = `user${currentUser.id}`;
            updateUserInfo();
            log(`–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${userId}`, 'success');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebRTC
        async function initWebRTC() {
            try {
                if (isWebRTCInitialized) {
                    log('WebRTC —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'warning');
                    return;
                }

                log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebRTC...', 'info');
                updateStatus('connecting');

                // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                if (peerConnection) {
                    peerConnection.close();
                    peerConnection = null;
                }

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
                currentCallTarget = null;
                incomingCallFrom = null;

                // –ü–æ–ª—É—á–∞–µ–º –º–µ–¥–∏–∞ –ø–æ—Ç–æ–∫–∏
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });

                document.getElementById('localVideo').srcObject = localStream;
                log('–ú–µ–¥–∏–∞ –ø–æ—Ç–æ–∫–∏ –ø–æ–ª—É—á–µ–Ω—ã', 'success');

                // –°–æ–∑–¥–∞–µ–º peer connection
                peerConnection = new RTCPeerConnection(configuration);

                // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫
                localStream.getTracks().forEach(track => {
                    peerConnection.addTrack(track, localStream);
                });

                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                peerConnection.onicecandidate = async (event) => {
                    if (event.candidate) {
                        await sendSignal('ice-candidate', {
                            candidate: event.candidate
                        });
                    }
                };

                peerConnection.ontrack = (event) => {
                    log('–£–¥–∞–ª–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –ø–æ–ª—É—á–µ–Ω', 'success');
                    remoteStream = event.streams[0];
                    document.getElementById('remoteVideo').srcObject = remoteStream;
                };

                peerConnection.onconnectionstatechange = () => {
                    log(`–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${peerConnection.connectionState}`, 'info');
                    if (peerConnection.connectionState === 'connected') {
                        updateStatus('connected');
                    } else if (peerConnection.connectionState === 'disconnected') {
                        updateStatus('disconnected');
                    }
                };

                peerConnection.oniceconnectionstatechange = () => {
                    log(`ICE —Å–æ—Å—Ç–æ—è–Ω–∏–µ: ${peerConnection.iceConnectionState}`, 'info');
                };

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª–∏–Ω–≥
                initSignaling();
                
                isWebRTCInitialized = true;
                log('WebRTC –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');

            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ WebRTC: ${error.message}`, 'error');
                updateStatus('disconnected');
            }
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ WebRTC
        function stopWebRTC() {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }

            if (peerConnection) {
                peerConnection.close();
                peerConnection = null;
            }

            if (signalCheckInterval) {
                clearInterval(signalCheckInterval);
                signalCheckInterval = null;
            }

            document.getElementById('localVideo').srcObject = null;
            document.getElementById('remoteVideo').srcObject = null;

            isWebRTCInitialized = false;
            updateStatus('disconnected');
            log('WebRTC –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'info');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª–∏–Ω–≥–∞
        function initSignaling() {
            if (!currentUserId) {
                log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
                return;
            }

            lastSignalId = Date.now();
            log(`–°–∏–≥–Ω–∞–ª–∏–Ω–≥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${currentUserId}`, 'success');

            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∏–≥–Ω–∞–ª–æ–≤
            signalCheckInterval = setInterval(checkForSignals, 2000);
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞
        async function sendSignal(type, data, targetUserId = null) {
            if (!currentUserId) {
                log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
                return;
            }

            try {
                const signalData = {
                    action: 'signal',
                    from: currentUserId,
                    to: targetUserId || 'broadcast',
                    type: type,
                    data: data,
                    timestamp: Date.now()
                };

                const response = await fetch(SIGNALING_SERVER, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(signalData)
                });

                const result = await response.json();
                if (result.success) {
                    log(`–°–∏–≥–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: ${type}`, 'success');
                } else {
                    log(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–∏–≥–Ω–∞–ª–∞: ${result.message}`, 'error');
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–∏–≥–Ω–∞–ª–∞: ${error.message}`, 'error');
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
        async function checkForSignals() {
            if (!currentUserId) return;

            try {
                const response = await fetch(SIGNALING_SERVER, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'get_signals',
                        userId: currentUserId,
                        lastSignalId: lastSignalId
                    })
                });

                const result = await response.json();
                if (result.success && result.signals) {
                    for (const signal of result.signals) {
                        await handleSignal(signal);
                        lastSignalId = Math.max(lastSignalId, signal.id);
                    }
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤: ${error.message}`, 'error');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–∞
        async function handleSignal(signal) {
            log(`–ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª: ${signal.type} –æ—Ç ${signal.from}`, 'info');

            switch (signal.type) {
                case 'offer':
                    await handleOffer(signal);
                    break;
                case 'answer':
                    await handleAnswer(signal);
                    break;
                case 'ice-candidate':
                    await handleIceCandidate(signal);
                    break;
                case 'call':
                    await handleIncomingCall(signal);
                    break;
                case 'call-accepted':
                    await handleCallAccepted(signal);
                    break;
                case 'call-rejected':
                    await handleCallRejected(signal);
                    break;
                case 'call-ended':
                    await handleCallEnded(signal);
                    break;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ offer
        async function handleOffer(signal) {
            try {
                await peerConnection.setRemoteDescription(signal.data);
                const answer = await peerConnection.createAnswer();
                await peerConnection.setLocalDescription(answer);
                await sendSignal('answer', answer, signal.from);
                log('Answer –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'success');
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ offer: ${error.message}`, 'error');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ answer
        async function handleAnswer(signal) {
            try {
                await peerConnection.setRemoteDescription(signal.data);
                log('Answer –ø–æ–ª—É—á–µ–Ω –∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω', 'success');
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ answer: ${error.message}`, 'error');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
        async function handleIceCandidate(signal) {
            try {
                await peerConnection.addIceCandidate(signal.data.candidate);
                log('ICE –∫–∞–Ω–¥–∏–¥–∞—Ç –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–∞: ${error.message}`, 'error');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞
        async function handleIncomingCall(signal) {
            incomingCallFrom = signal.from;
            log(`–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ –æ—Ç ${signal.from}`, 'warning');
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—Ö–æ–¥—è—â–µ–º –∑–≤–æ–Ω–∫–µ
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏–Ω—è—Ç–æ–≥–æ –∑–≤–æ–Ω–∫–∞
        async function handleCallAccepted(signal) {
            log(`–ó–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω—è—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ${signal.from}`, 'success');
            // –°–æ–∑–¥–∞–µ–º offer
            const offer = await peerConnection.createOffer();
            await peerConnection.setLocalDescription(offer);
            await sendSignal('offer', offer, signal.from);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞
        async function handleCallRejected(signal) {
            log(`–ó–≤–æ–Ω–æ–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ${signal.from}`, 'warning');
            currentCallTarget = null;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞
        async function handleCallEnded(signal) {
            log(`–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ${signal.from}`, 'info');
            currentCallTarget = null;
            incomingCallFrom = null;
        }

        // –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –∑–≤–æ–Ω–∫–∞
        async function initiateCall(targetUserId) {
            if (!isWebRTCInitialized) {
                log('WebRTC –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                return;
            }

            currentCallTarget = targetUserId;
            await sendSignal('call', { message: '–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫' }, targetUserId);
            log(`–ó–≤–æ–Ω–æ–∫ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${targetUserId}`, 'info');
        }

        // –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–≤–æ–Ω–∫–∞
        async function acceptCall() {
            if (!incomingCallFrom) {
                log('–ù–µ—Ç –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞', 'error');
                return;
            }

            await sendSignal('call-accepted', { message: '–ó–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω—è—Ç' }, incomingCallFrom);
            log('–ó–≤–æ–Ω–æ–∫ –ø—Ä–∏–Ω—è—Ç', 'success');
        }

        // –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
        async function rejectCall() {
            if (!incomingCallFrom) {
                log('–ù–µ—Ç –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞', 'error');
                return;
            }

            await sendSignal('call-rejected', { message: '–ó–≤–æ–Ω–æ–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω' }, incomingCallFrom);
            incomingCallFrom = null;
            log('–ó–≤–æ–Ω–æ–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω', 'info');
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
        async function endCall() {
            if (currentCallTarget) {
                await sendSignal('call-ended', { message: '–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω' }, currentCallTarget);
                currentCallTarget = null;
            }
            if (incomingCallFrom) {
                await sendSignal('call-ended', { message: '–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω' }, incomingCallFrom);
                incomingCallFrom = null;
            }
            log('–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω', 'info');
        }

        // –¢–µ—Å—Ç —Å–∏–≥–Ω–∞–ª–∏–Ω–≥–∞
        async function testSignaling() {
            if (!currentUserId) {
                log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'error');
                return;
            }

            try {
                const response = await fetch(SIGNALING_SERVER, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'ping',
                        from: currentUserId,
                        to: 'test'
                    })
                });

                const result = await response.json();
                if (result.success) {
                    log('–°–∏–≥–Ω–∞–ª–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                } else {
                    log('–°–∏–≥–Ω–∞–ª–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∏–Ω–≥–∞: ${error.message}`, 'error');
            }
        }

        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function searchUser() {
            const phone = document.getElementById('searchPhone').value.trim();
            if (!phone) {
                log('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'error');
                return;
            }

            try {
                const response = await fetch('api/search_user.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ phone: phone })
                });

                const data = await response.json();
                if (data.success) {
                    showSearchResult(data.user, phone);
                } else {
                    document.getElementById('searchResult').innerHTML = 
                        `<p style="color: red;">${data.message}</p>`;
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${error.message}`, 'error');
                document.getElementById('searchResult').innerHTML = 
                    '<p style="color: red;">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>';
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∏—Å–∫–∞
        function showSearchResult(user, phone) {
            const resultDiv = document.getElementById('searchResult');
            resultDiv.innerHTML = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <h4>–ù–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${phone}</h4>
                    <p>ID: ${user.id}</p>
                    <button class="btn btn-success" onclick="initiateCall('user${user.id}')">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
                </div>
            `;
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'contacts') {
                loadContacts();
            } else if (tabName === 'requests') {
                loadRequests();
            } else if (tabName === 'rejected') {
                loadRejected();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
        async function loadContacts() {
            if (!currentUser) {
                document.getElementById('contactsList').innerHTML = '<p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>';
                return;
            }

            try {
                const response = await fetch('api/get_contacts.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userId: currentUser.id })
                });

                const data = await response.json();
                if (data.success) {
                    displayContacts(data.contacts);
                } else {
                    document.getElementById('contactsList').innerHTML = 
                        `<p style="color: red;">${data.message}</p>`;
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: ${error.message}`, 'error');
                document.getElementById('contactsList').innerHTML = 
                    '<p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤</p>';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
        function displayContacts(contacts) {
            const contactsList = document.getElementById('contactsList');
            if (contacts.length === 0) {
                contactsList.innerHTML = '<p>–ö–æ–Ω—Ç–∞–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            contactsList.innerHTML = contacts.map(contact => `
                <div class="contact-item">
                    <div class="contact-info">
                        <h4>${contact.phone}</h4>
                        <p>ID: ${contact.contact_user_id}</p>
                    </div>
                    <div class="contact-actions">
                        <button class="btn btn-success" onclick="initiateCall('user${contact.contact_user_id}')">üìû</button>
                        <button class="btn btn-danger" onclick="removeContact(${contact.contact_user_id})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
        async function loadRequests() {
            if (!currentUser) {
                document.getElementById('requestsList').innerHTML = '<p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>';
                return;
            }

            try {
                const response = await fetch('api/get_requests.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userId: currentUser.id })
                });

                const data = await response.json();
                if (data.success) {
                    displayRequests(data.requests);
                } else {
                    document.getElementById('requestsList').innerHTML = 
                        `<p style="color: red;">${data.message}</p>`;
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤: ${error.message}`, 'error');
                document.getElementById('requestsList').innerHTML = 
                    '<p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤</p>';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
        function displayRequests(requests) {
            const requestsList = document.getElementById('requestsList');
            if (requests.length === 0) {
                requestsList.innerHTML = '<p>–ó–∞–ø—Ä–æ—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            requestsList.innerHTML = requests.map(request => `
                <div class="contact-item">
                    <div class="contact-info">
                        <h4>${request.phone}</h4>
                        <p>ID: ${request.from_user_id}</p>
                    </div>
                    <div class="contact-actions">
                        <button class="btn btn-success" onclick="acceptRequest(${request.from_user_id})">‚úÖ</button>
                        <button class="btn btn-danger" onclick="rejectRequest(${request.from_user_id})">‚ùå</button>
                    </div>
                </div>
            `).join('');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö
        async function loadRejected() {
            if (!currentUser) {
                document.getElementById('rejectedList').innerHTML = '<p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>';
                return;
            }

            try {
                const response = await fetch('api/get_rejected.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userId: currentUser.id })
                });

                const data = await response.json();
                if (data.success) {
                    displayRejected(data.rejected);
                } else {
                    document.getElementById('rejectedList').innerHTML = 
                        `<p style="color: red;">${data.message}</p>`;
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö: ${error.message}`, 'error');
                document.getElementById('rejectedList').innerHTML = 
                    '<p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö</p>';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã—Ö
        function displayRejected(rejected) {
            const rejectedList = document.getElementById('rejectedList');
            if (rejected.length === 0) {
                rejectedList.innerHTML = '<p>–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                return;
            }

            rejectedList.innerHTML = rejected.map(reject => `
                <div class="contact-item">
                    <div class="contact-info">
                        <h4>${reject.phone}</h4>
                        <p>ID: ${reject.from_user_id}</p>
                    </div>
                    <div class="contact-actions">
                        <button class="btn btn-success" onclick="acceptRequest(${reject.from_user_id})">‚úÖ</button>
                    </div>
                </div>
            `).join('');
        }

        // –ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞–ø—Ä–æ—Å–∞
        async function acceptRequest(userId) {
            try {
                const response = await fetch('api/accept_invitation.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        userId: currentUser.id,
                        contactUserId: userId 
                    })
                });

                const data = await response.json();
                if (data.success) {
                    log('–ó–∞–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç', 'success');
                    loadRequests();
                    loadContacts();
                } else {
                    log(`–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–ø—Ä–æ—Å–∞: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
            }
        }

        // –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
        async function rejectRequest(userId) {
            try {
                const response = await fetch('api/reject_invitation.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        userId: currentUser.id,
                        contactUserId: userId 
                    })
                });

                const data = await response.json();
                if (data.success) {
                    log('–ó–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω–µ–Ω', 'info');
                    loadRequests();
                } else {
                    log(`–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
        async function removeContact(userId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç?')) return;

            try {
                const response = await fetch('api/remove_contact.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        userId: currentUser.id,
                        contactUserId: userId 
                    })
                });

                const data = await response.json();
                if (data.success) {
                    log('–ö–æ–Ω—Ç–∞–∫—Ç —É–¥–∞–ª–µ–Ω', 'info');
                    loadContacts();
                } else {
                    log(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞: ${error.message}`, 'error');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
            updateUserInfo();
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ã—Å—Ç—Ä—ã–π –≤—Ö–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            setTimeout(() => {
                quickLogin();
            }, 1000);
        };

        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onbeforeunload = function() {
            stopWebRTC();
        };
    </script>
</body>
</html>
